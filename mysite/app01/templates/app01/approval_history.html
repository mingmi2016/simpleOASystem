<!-- app01/templates/app01/approval_history.html -->
{% extends 'base.html' %}

{% block content %}
<h1>审批历史</h1>
<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        padding: 8px;
        border: 1px solid #ddd;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    td.expandable:hover {
        white-space: normal;
        word-wrap: break-word;
    }
</style>
<table>
    <thead>
        <tr>
            <th>申请编号</th>
            <th>申请人</th>
            <th>申请物品</th>
            <th>申请原因</th>
            <th>创建时间</th>
            <th>审批历史</th>
        </tr>
    </thead>
    <tbody>
    {% for item in approval_history %}
        <tr>
            <td>{{ item.supply_request.id }}</td>
            <td>{{ item.supply_request.employee }}</td>
            <td class="expandable">
                {% for supply_item in item.items %}
                    {{ supply_item.supply_option.name }} ({{ supply_item.quantity }}){% if not forloop.last %}, {% endif %}
                {% endfor %}
            </td>
            <td class="expandable">{{ item.supply_request.reason }}</td>
            <td>{{ item.supply_request.created_at|date:"Y-m-d H:i" }}</td>
            <td class="expandable">
                {% for approval in item.approvals %}
                    {{ approval.approver }} ({{ approval.get_status_display }}){% if approval.comment %}: {{ approval.comment }}{% endif %}
                    {% if not forloop.last %}<br>{% endif %}
                {% empty %}
                    暂无审批记录
                {% endfor %}
            </td>
        </tr>
    {% empty %}
        <tr>
            <td colspan="6">目前没有任何审批历史记录</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}
